/*
 * jQuery Selectbox plugin 0.2
 *
 * Copyright 2011-2012, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 * 
 * Date: Tue Jul 17 19:58:36 2012 +0300
 */


;(function ($) {

!function(a,b){function f(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}var c="selectbox",d=!1,e=!0;a.extend(f.prototype,{_isOpenSelectbox:function(a){if(!a)return d;var b=this._getInst(a);return b.isOpen},_isDisabledSelectbox:function(a){if(!a)return d;var b=this._getInst(a);return b.isDisabled},_attachSelectbox:function(b,f){function r(){var b,c,d=this.attr("id").split("_")[1];for(b in h._state)b!==d&&h._state.hasOwnProperty(b)&&(c=a("select[sb='"+b+"']")[0],c&&h._closeSelectbox(c))}function s(){var c=arguments[1]&&arguments[1].sub?!0:!1,d=arguments[1]&&arguments[1].disabled?!0:!1;arguments[0].each(function(f){var o,g=a(this),j=a("<li>");g.is(":selected")&&(k.text(g.text()),n=e),f===q-1&&j.addClass("last"),g.is(":disabled")||d?(o=a("<span>",{text:g.text()}).addClass(i.settings.classDisabled),c&&o.addClass(i.settings.classSub),o.appendTo(j)):(o=a("<a>",{href:"#"+g.val(),rel:g.val()}).text(g.text()).bind("click.sb",function(c){c&&c.preventDefault&&c.preventDefault();var d=l,e=a(this);d.attr("id").split("_")[1],h._changeSelectbox(b,e.attr("rel"),e.text()),h._closeSelectbox(b)}).bind("mouseover.sb",function(){var b=a(this);b.parent().siblings().find("a").removeClass(i.settings.classFocus),b.addClass(i.settings.classFocus)}).bind("mouseout.sb",function(){a(this).removeClass(i.settings.classFocus)}),c&&o.addClass(i.settings.classSub),g.is(":selected")&&o.addClass(i.settings.classFocus),o.appendTo(j)),j.appendTo(m)})}if(this._getInst(b))return d;var j,k,l,m,g=a(b),h=this,i=h._newInst(g),n=d,p=(g.find("optgroup"),g.find("option")),q=p.length;g.attr("sb",i.uid),a.extend(i.settings,h._defaults,f),h._state[i.uid]=d,g.hide(),j=a("<div>",{id:"sbHolder_"+i.uid,"class":i.settings.classHolder,tabindex:g.attr("tabindex")}),k=a("<a>",{id:"sbSelector_"+i.uid,href:"#","class":i.settings.classSelector,click:function(c){c.preventDefault(),r.apply(a(this),[]);var d=a(this).attr("id").split("_")[1];h._state[d]?h._closeSelectbox(b):h._openSelectbox(b)}}),l=a("<a>",{id:"sbToggle_"+i.uid,href:"#","class":i.settings.classToggle,click:function(c){c.preventDefault(),r.apply(a(this),[]);var d=a(this).attr("id").split("_")[1];h._state[d]?h._closeSelectbox(b):h._openSelectbox(b)}}),l.appendTo(j),m=a("<ul>",{id:"sbOptions_"+i.uid,"class":i.settings.classOptions,css:{display:"none"}}),g.children().each(function(){var d,c=a(this),e={};c.is("option")?s(c):c.is("optgroup")&&(d=a("<li>"),a("<span>",{text:c.attr("label")}).addClass(i.settings.classGroup).appendTo(d),d.appendTo(m),c.is(":disabled")&&(e.disabled=!0),e.sub=!0,s(c.find("option"),e))}),n||k.text(p.first().text()),a.data(b,c,i),j.data("uid",i.uid).bind("keydown.sb",function(b){var d=b.charCode?b.charCode:b.keyCode?b.keyCode:0,e=a(this),f=e.data("uid"),g=e.siblings("select[sb='"+f+"']").data(c),i=e.siblings(["select[sb='",f,"']"].join("")).get(0),j=e.find("ul").find("a."+g.settings.classFocus);switch(d){case 37:case 38:if(j.length>0){var k;a("a",e).removeClass(g.settings.classFocus),k=j.parent().prevAll("li:has(a)").eq(0).find("a"),k.length>0&&(k.addClass(g.settings.classFocus).focus(),a("#sbSelector_"+f).text(k.text()))}break;case 39:case 40:var k;a("a",e).removeClass(g.settings.classFocus),k=j.length>0?j.parent().nextAll("li:has(a)").eq(0).find("a"):e.find("ul").find("a").eq(0),k.length>0&&(k.addClass(g.settings.classFocus).focus(),a("#sbSelector_"+f).text(k.text()));break;case 13:j.length>0&&h._changeSelectbox(i,j.attr("rel"),j.text()),h._closeSelectbox(i);break;case 9:if(i){var g=h._getInst(i);g&&(j.length>0&&h._changeSelectbox(i,j.attr("rel"),j.text()),h._closeSelectbox(i))}var l=parseInt(e.attr("tabindex"),10);b.shiftKey?l--:l++,a("*[tabindex='"+l+"']").focus();break;case 27:h._closeSelectbox(i)}return b.stopPropagation(),!1}).delegate("a","mouseover",function(){a(this).addClass(i.settings.classFocus)}).delegate("a","mouseout",function(){a(this).removeClass(i.settings.classFocus)}),k.appendTo(j),m.appendTo(j),j.insertAfter(g),a("html").live("mousedown",function(b){b.stopPropagation(),a("select").selectbox("close")}),a([".",i.settings.classHolder,", .",i.settings.classSelector].join("")).mousedown(function(a){a.stopPropagation()})},_detachSelectbox:function(b){var e=this._getInst(b);return e?(a("#sbHolder_"+e.uid).remove(),a.data(b,c,null),a(b).show(),void 0):d},_changeSelectbox:function(b,c,d){var e,f=this._getInst(b);f&&(e=this._get(f,"onChange"),a("#sbSelector_"+f.uid).text(d)),c=c.replace(/\'/g,"\\'");var g=a(b).find("option").filter(function(){var b=a(this);return c==(b.val()||b.text())});g.prop("selected",!0),f&&e?e.apply(f.input?f.input[0]:null,[c,f]):f&&f.input&&f.input.trigger("change")},_enableSelectbox:function(b){var e=this._getInst(b);return e&&e.isDisabled?(a("#sbHolder_"+e.uid).removeClass(e.settings.classHolderDisabled),e.isDisabled=d,a.data(b,c,e),void 0):d},_disableSelectbox:function(b){var f=this._getInst(b);return!f||f.isDisabled?d:(a("#sbHolder_"+f.uid).addClass(f.settings.classHolderDisabled),f.isDisabled=e,a.data(b,c,f),void 0)},_optionSelectbox:function(b,e,f){var g=this._getInst(b);return g?(g[e]=f,a.data(b,c,g),void 0):d},_openSelectbox:function(b){var d=this._getInst(b);if(d&&!d.isOpen&&!d.isDisabled){var f=a("#sbOptions_"+d.uid),g=parseInt(a(window).height(),10),h=a("#sbHolder_"+d.uid).offset(),i=a(window).scrollTop(),j=f.prev().height(),k=g-(h.top-i)-j/2,l=this._get(d,"onOpen");f.css({top:j+"px",maxHeight:k-j+"px"}),"fade"===d.settings.effect?f.fadeIn(d.settings.speed):f.slideDown(d.settings.speed),a("#sbToggle_"+d.uid).addClass(d.settings.classToggleOpen),this._state[d.uid]=e,d.isOpen=e,l&&l.apply(d.input?d.input[0]:null,[d]),a.data(b,c,d)}},_closeSelectbox:function(b){var e=this._getInst(b);if(e&&e.isOpen){var f=this._get(e,"onClose");"fade"===e.settings.effect?a("#sbOptions_"+e.uid).fadeOut(e.settings.speed):a("#sbOptions_"+e.uid).slideUp(e.settings.speed),a("#sbToggle_"+e.uid).removeClass(e.settings.classToggleOpen),this._state[e.uid]=d,e.isOpen=d,f&&f.apply(e.input?e.input[0]:null,[e]),a.data(b,c,e)}},_newInst:function(a){var b=a[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:b,input:a,uid:Math.floor(99999999*Math.random()),isOpen:d,isDisabled:d,settings:{}}},_getInst:function(b){try{return a.data(b,c)}catch(d){throw"Missing instance data for this selectbox"}},_get:function(a,c){return a.settings[c]!==b?a.settings[c]:this._defaults[c]}}),a.fn.selectbox=function(b){var c=Array.prototype.slice.call(arguments,1);return"string"==typeof b&&"isDisabled"==b?a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this[0]].concat(c)):"option"==b&&2==arguments.length&&"string"==typeof arguments[1]?a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this[0]].concat(c)):this.each(function(){"string"==typeof b?a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this].concat(c)):a.selectbox._attachSelectbox(this,b)})},a.selectbox=new f,a.selectbox.version="0.8"}(jQuery);

})(jQuery);